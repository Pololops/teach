# Implementation Tasks: Teach - AI English Learning Chat

**Branch**: `001-teach` | **Date**: 2025-11-15 | **Spec**: [spec.md](./spec.md)

**Input**: This file is generated by the `/speckit.tasks` command from design artifacts in `specs/001-teach/`.

## Task Organization

Tasks are organized by **User Story Priority** following the specification:
- **P1**: Natural AI Conversation (MVP core)
- **P2**: Automatic Difficulty Adaptation
- **P3**: Simple and Engaging Interface
- **P4**: Progress Tracking

Each task follows the format:
```
- [ ] [TASK-ID] [P?] [Story?] Description (file: path/to/file.ts:line)
```

## Task Summary

**Total Tasks**: 89
**MVP Scope** (P1 + P2 + Foundation): 62 tasks
**Full Feature Set** (P1-P4): 89 tasks

**Parallel Opportunities**:
- Phase 1 (Setup): Tasks 001-008 can run in parallel after monorepo initialization
- Phase 2 (Foundation): Backend and frontend foundations can be built in parallel
- Feature implementation: Different features can be developed concurrently by team members

## Phase 0: Project Initialization (8 tasks)

**Goal**: Set up monorepo structure with pnpm workspaces, TypeScript configurations, and base tooling.

### 0.1 Monorepo Setup

- [ ] [TASK-001] Initialize root pnpm workspace (file: pnpm-workspace.yaml)
  - Create root package.json with engines: node >=25.2.0, pnpm >=10.22.0
  - Create pnpm-workspace.yaml with packages: apps/*, packages/*
  - Add root scripts: dev, build, test, typecheck, lint
  - Configure .gitignore for node_modules, dist, .env files

- [ ] [TASK-002] Create apps/frontend package structure (file: apps/frontend/package.json)
  - Initialize Vite React TypeScript template: pnpm create vite@latest . --template react-ts
  - Install React 19.0.2+, react-dom 19.0.2+
  - Install Vite 7.2.2+, TypeScript 5.9+
  - Configure tsconfig.json with strict mode, path aliases (@/)

- [ ] [TASK-003] Create apps/backend package structure (file: apps/backend/package.json)
  - Initialize Node.js package with type: "module"
  - Install Hono 4.10.6+, @hono/node-server 1.14.2+
  - Install TypeScript 5.9+, tsx 4.19.2+ (dev)
  - Configure tsconfig.json for Node.js ESM

- [ ] [TASK-004] Create packages/shared package structure (file: packages/shared/package.json)
  - Initialize shared types package
  - Install Zod 3.24.1+ for runtime validation
  - Install TypeScript 5.9+
  - Export shared types: Message, Conversation, CEFRLevel, etc.

### 0.2 Development Tooling

- [ ] [TASK-005] Configure Tailwind CSS 4.1+ with Vite plugin (file: apps/frontend/tailwind.config.ts)
  - Install tailwindcss@^4.1.0, @tailwindcss/vite@^4.1.0
  - Configure CSS-first approach (@config directive)
  - Set up design tokens (colors, spacing, typography)
  - Configure mobile-first breakpoints (375px-1920px+)

- [ ] [TASK-006] Install and configure Shadcn UI components (file: apps/frontend/components.json)
  - Run shadcn-ui init with Tailwind CSS 4 support
  - Install Radix UI dependencies (@radix-ui/react-*)
  - Install lucide-react for icons
  - Configure component path: src/shared/components/ui

- [ ] [TASK-007] Set up testing infrastructure (file: apps/frontend/vitest.config.ts)
  - Install Vitest 2.2.0+, @vitest/ui, happy-dom (frontend)
  - Install Playwright 1.49.1+, @axe-core/playwright (E2E)
  - Configure Vitest for React component tests
  - Configure Playwright for E2E tests with accessibility checks

- [ ] [TASK-008] Configure environment variables (file: .env.example)
  - Create .env.example templates for frontend and backend
  - Frontend: VITE_AI_PROXY_URL, VITE_DEFAULT_AI_PROVIDER
  - Backend: OPENAI_API_KEY, ANTHROPIC_API_KEY, PORT, NODE_ENV
  - Add .env to .gitignore (security)

## Phase 1: Foundational Infrastructure (16 tasks)

**Goal**: Build core infrastructure - storage, state management, AI abstraction, backend proxy.

### 1.1 Local Storage (IndexedDB with Dexie.js)

- [ ] [TASK-009] Install Dexie.js dependencies (file: apps/frontend/package.json)
  - Install dexie@^4.0.10, dexie-react-hooks@^1.1.7
  - Add to dependencies in frontend package.json

- [ ] [TASK-010] Define Dexie.js database schema (file: apps/frontend/src/shared/lib/storage/db.ts)
  - Create TeachDB class extending Dexie
  - Define tables: users, conversations, messages, progressMetrics
  - Configure indexes: conversationId+timestamp, userId+createdAt, status
  - Export singleton db instance

- [ ] [TASK-011] Implement User entity and validation (file: apps/frontend/src/shared/lib/storage/entities/user.ts)
  - Define User interface with id, displayName, currentLevel, preferences, timestamps
  - Implement Zod schema for User validation
  - Create CRUD operations: getUser(), updateUser(), updatePreferences()

- [ ] [TASK-012] Implement Conversation entity and validation (file: apps/frontend/src/shared/lib/storage/entities/conversation.ts)
  - Define Conversation interface with id, userId, title, difficultyLevel, status, messageCount
  - Implement Zod schema for Conversation validation
  - Create CRUD operations: createConversation(), getConversations(), updateConversation(), deleteConversation()
  - Implement status transitions: active â†’ archived â†’ deleted

- [ ] [TASK-013] Implement Message entity and validation (file: apps/frontend/src/shared/lib/storage/entities/message.ts)
  - Define Message interface with id, conversationId, role, content, timestamp, metadata
  - Define MessageMetadata with corrections, suggestions, detectedLevel, vocabularyUsed
  - Implement Zod schema for Message validation (content 1-5000 chars)
  - Create CRUD operations: addMessage(), getMessages(), updateMessage()

- [ ] [TASK-014] Implement ProgressMetrics entity (file: apps/frontend/src/shared/lib/storage/entities/progress.ts)
  - Define ProgressMetrics interface with userId, currentLevel, levelHistory, totalConversations, totalMessages, totalTime, vocabularyEncountered, vocabularyMastered
  - Implement computed metrics: averageMessagesPerConversation, vocabularyGrowthRate, currentStreak
  - Create operations: getProgress(), updateProgress(), trackVocabulary()

### 1.2 State Management (Zustand + TanStack Query)

- [ ] [TASK-015] Install state management dependencies (file: apps/frontend/package.json)
  - Install zustand@^5.0.2 for client state
  - Install @tanstack/react-query@^5.62.11, @tanstack/react-query-devtools@^5.62.11

- [ ] [TASK-016] Create UI store with Zustand (file: apps/frontend/src/shared/stores/uiStore.ts)
  - Define state: isTyping, isSidebarOpen, theme, activeConversationId
  - Create actions: setTyping(), toggleSidebar(), setTheme(), setActiveConversation()
  - Persist theme preference to localStorage

- [ ] [TASK-017] Create user store with Zustand (file: apps/frontend/src/shared/stores/userStore.ts)
  - Define state: currentUser, currentLevel, preferences
  - Create actions: loadUser(), updateLevel(), updatePreferences()
  - Sync with IndexedDB on state changes

- [ ] [TASK-018] Configure TanStack Query client (file: apps/frontend/src/shared/lib/query/queryClient.ts)
  - Create QueryClient with default options (staleTime, cacheTime, retry)
  - Enable devtools in development mode
  - Configure optimistic updates for AI messages

### 1.3 AI Provider Abstraction

- [ ] [TASK-019] Install AI SDK dependencies (file: apps/frontend/package.json and apps/backend/package.json)
  - Frontend: Install ai@^4.1.35 (Vercel AI SDK)
  - Backend: Install ai@^4.1.35, openai@^5.0.2, @anthropic-ai/sdk@^0.38.0

- [ ] [TASK-020] Define AI provider base interface (file: apps/backend/src/lib/ai/providers/base.ts)
  - Create AIProvider interface with methods: streamResponse(messages, targetLevel), getModelConfig()
  - Define unified message format (role, content)
  - Define streaming response protocol

- [ ] [TASK-021] Implement OpenAI provider (file: apps/backend/src/lib/ai/providers/openai.ts)
  - Implement AIProvider interface using OpenAI SDK
  - Configure model: gpt-4o-mini for cost efficiency
  - Implement streaming with Server-Sent Events (SSE)
  - Add system prompt for English learning tutor with CEFR level adaptation

- [ ] [TASK-022] Implement Anthropic provider (file: apps/backend/src/lib/ai/providers/anthropic.ts)
  - Implement AIProvider interface using Anthropic SDK
  - Configure model: claude-3-5-sonnet-20241022
  - Implement streaming with SSE
  - Add system prompt for English learning tutor with CEFR level adaptation

- [ ] [TASK-023] Create provider factory and auto-selection (file: apps/backend/src/lib/ai/index.ts)
  - Implement getProvider(name: string) factory function
  - Implement auto provider selection based on availability (health check)
  - Add fallback mechanism: OpenAI â†’ Anthropic â†’ error
  - Export unified AI service interface

### 1.4 Backend API (Hono)

- [ ] [TASK-024] Create Hono app entry point (file: apps/backend/src/index.ts)
  - Initialize Hono app with CORS middleware
  - Configure middleware: logger, error handler
  - Import and mount routes: /api/health, /api/chat
  - Start server on PORT from env (default 3000)

- [ ] [TASK-025] Implement health check endpoint (file: apps/backend/src/routes/health.ts)
  - GET /api/health
  - Return: { status: "healthy", version: "1.0.0", timestamp }
  - Test: curl http://localhost:3000/api/health

## Phase 2: User Story 1 (P1) - Natural AI Conversation (21 tasks)

**Goal**: Implement core chat feature - send messages, stream AI responses, display conversation history.

**Success Criteria**:
- âœ… User can send message in English and receive response within 2 seconds (SC-002)
- âœ… Conversation feels natural and human-like (SC-003)
- âœ… Users complete 5+ minute conversations (SC-001)

### 2.1 Chat Feature - Backend API

- [ ] [TASK-026] [P1] [US1] Implement streaming chat endpoint (file: apps/backend/src/routes/chat.ts)
  - POST /api/chat/stream
  - Accept: { messages: ChatMessage[], targetLevel: CEFRLevel, provider?: string }
  - Call AI provider with streaming enabled
  - Return SSE stream with chunks: data: {"content": "Hello"}\n\n
  - End stream with: data: [DONE]\n\n
  - Add error handling and rate limiting

- [ ] [TASK-027] [P1] [US1] Implement non-streaming fallback endpoint (file: apps/backend/src/routes/chat.ts)
  - POST /api/chat/message
  - Accept same body as streaming endpoint
  - Return complete response: { message: { role, content }, metadata: { provider, model, tokensUsed } }
  - Use for clients without SSE support

- [ ] [TASK-028] [P1] [US1] Add rate limiting middleware (file: apps/backend/src/lib/middleware/rateLimit.ts)
  - Limit to 100 requests per hour per IP
  - Return 429 status with headers: X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset
  - Persist rate limit state in memory (or Redis for production)

### 2.2 Chat Feature - Frontend Service Layer

- [ ] [TASK-029] [P1] [US1] Create chat service (file: apps/frontend/src/features/chat/services/chatService.ts)
  - Function: sendMessage(conversationId, content) â†’ saves to IndexedDB
  - Function: streamAIResponse(messages, targetLevel) â†’ calls backend /api/chat/stream
  - Function: saveAIResponse(conversationId, content, metadata) â†’ saves to IndexedDB
  - Handle errors gracefully (offline, API failure)

- [ ] [TASK-030] [P1] [US1] Implement useChat hook (file: apps/frontend/src/features/chat/hooks/useChat.ts)
  - State: messages, isStreaming, error
  - Actions: sendMessage(text), resetConversation()
  - Optimistic updates: add user message immediately
  - Stream AI response with SSE (EventSource API)
  - Update message list in real-time as chunks arrive

- [ ] [TASK-031] [P1] [US1] Implement useMessages hook (file: apps/frontend/src/features/chat/hooks/useMessages.ts)
  - Use useLiveQuery from dexie-react-hooks
  - Query messages by conversationId, sorted by timestamp
  - Return reactive message list (updates automatically)

### 2.3 Chat Feature - UI Components

- [ ] [TASK-032] [P1] [US1] Install Shadcn components for chat UI (file: apps/frontend/src/shared/components/ui/)
  - Run: npx shadcn@latest add button input scroll-area
  - Components needed: Button, Input, ScrollArea

- [ ] [TASK-033] [P1] [US1] Create ChatContainer component (file: apps/frontend/src/features/chat/components/ChatContainer.tsx)
  - Layout: full viewport height, flex column
  - Header: app title "Teach" + level badge + progress button
  - Body: MessageList (scrollable)
  - Footer: MessageInput (fixed bottom)
  - Mobile-first responsive design

- [ ] [TASK-034] [P1] [US1] Create MessageList component (file: apps/frontend/src/features/chat/components/MessageList.tsx)
  - Map messages to MessageBubble components
  - Auto-scroll to bottom on new message
  - Show typing indicator when AI is responding
  - Handle empty state: AI greeting "Hi! What would you like to talk about today?"

- [ ] [TASK-035] [P1] [US1] Create MessageBubble component (file: apps/frontend/src/features/chat/components/MessageBubble.tsx)
  - Props: role (user | assistant), content, timestamp, metadata
  - Styling: user messages right-aligned (blue), AI messages left-aligned (gray)
  - Show timestamp on hover
  - Render corrections inline (P2 feature, prepare hooks)

- [ ] [TASK-036] [P1] [US1] Create MessageInput component (file: apps/frontend/src/features/chat/components/MessageInput.tsx)
  - Textarea with auto-resize (max 4 lines)
  - Send button (Enter key or click)
  - Disable while streaming
  - Show character count (max 5000)
  - Accessibility: aria-label, keyboard navigation

- [ ] [TASK-037] [P1] [US1] Create TypingIndicator component (file: apps/frontend/src/features/chat/components/TypingIndicator.tsx)
  - Animated dots: "AI is typing..."
  - Show when isStreaming = true
  - Smooth fade-in/out animation

### 2.4 Chat Feature - Integration & Testing

- [ ] [TASK-038] [P1] [US1] Integrate chat feature in App.tsx (file: apps/frontend/src/App.tsx)
  - Wrap app with QueryClientProvider
  - Initialize user on mount (load from IndexedDB or create default)
  - Render ChatContainer as main component
  - Add ErrorBoundary for graceful error handling

- [ ] [TASK-039] [P1] [US1] Create initial conversation on app load (file: apps/frontend/src/features/chat/services/initService.ts)
  - Check if user has active conversation
  - If not, create new conversation with AI greeting message
  - Save to IndexedDB
  - Set as activeConversationId in UI store

- [ ] [TASK-040] [P1] [US1] Write unit tests for chat service (file: apps/frontend/src/features/chat/services/chatService.test.ts)
  - Test: sendMessage saves to IndexedDB
  - Test: streamAIResponse calls backend API
  - Test: error handling (offline, API failure)
  - Use Vitest with mocked IndexedDB and fetch

- [ ] [TASK-041] [P1] [US1] Write component tests for MessageInput (file: apps/frontend/src/features/chat/components/MessageInput.test.tsx)
  - Test: typing in textarea updates state
  - Test: Enter key sends message
  - Test: disabled state while streaming
  - Test: character count validation
  - Use Vitest + happy-dom

- [ ] [TASK-042] [P1] [US1] Write E2E test for chat flow (file: tests/e2e/chat-flow.spec.ts)
  - Test: User opens app â†’ sees AI greeting
  - Test: User types "Hello, how are you?" â†’ sends message
  - Test: AI response appears within 3 seconds
  - Test: Conversation history persists on reload
  - Use Playwright

- [ ] [TASK-043] [P1] [US1] Performance optimization: code splitting (file: apps/frontend/vite.config.ts)
  - Lazy load non-critical features: Progress, Settings
  - Configure Vite code splitting for chunks <50KB
  - Verify bundle size <200KB gzipped (constitution requirement)

- [ ] [TASK-044] [P1] [US1] Performance optimization: AI response streaming (file: apps/frontend/src/features/chat/hooks/useChat.ts)
  - Ensure time-to-first-token <100ms
  - Use EventSource for SSE streaming
  - Implement exponential backoff on connection failure
  - Test with throttled network (Playwright)

- [ ] [TASK-045] [P1] [US1] Accessibility audit for chat interface (file: tests/e2e/accessibility.spec.ts)
  - Run axe-core automated tests
  - Test keyboard navigation: Tab through input, button
  - Test screen reader: ARIA labels on MessageBubble, MessageInput
  - Test touch targets: minimum 44x44px
  - Ensure WCAG 2.1 AA compliance

- [ ] [TASK-046] [P1] [US1] Manual testing checklist for P1 (file: specs/001-teach/TESTING.md)
  - [ ] Open app on mobile (375px width) â†’ interface usable
  - [ ] Send 5+ messages â†’ conversation flows naturally
  - [ ] Reload page â†’ conversation history persists
  - [ ] Disconnect network â†’ graceful error message
  - [ ] AI response time <2 seconds (95th percentile)

## Phase 3: User Story 2 (P2) - Automatic Difficulty Adaptation (18 tasks)

**Goal**: Implement CEFR level detection and automatic difficulty adjustment.

**Success Criteria**:
- âœ… AI adjusts conversation difficulty to user's level (SC-004: 85% accuracy)
- âœ… Beginner users receive simple vocabulary, advanced users receive complex sentences

### 3.1 Level Detection - Algorithm & Service

- [ ] [TASK-047] [P2] [US2] Define CEFR types and constants (file: packages/shared/src/types/cefr.ts)
  - Export CEFRLevel enum: A1, A2, B1, B2, C1, C2
  - Export CEFRMetrics interface: vocabularyComplexity, grammarAccuracy, sentenceLength, errorCount
  - Export CEFR_VOCABULARY_LISTS: Map<CEFRLevel, string[]> (top 1000 words per level)

- [ ] [TASK-048] [P2] [US2] Implement rule-based level detection (file: apps/frontend/src/features/level-detection/services/ruleBasedDetector.ts)
  - Function: analyzeVocabulary(text: string) â†’ vocabularyComplexity score (0-1)
  - Function: analyzeSentenceLength(text: string) â†’ avg words per sentence
  - Function: analyzeGrammarComplexity(text: string) â†’ score (0-1) based on tenses, clauses
  - Function: detectLevel(text: string) â†’ CEFRLevel (combine metrics with weighted algorithm)
  - Use CEFR vocabulary lists for vocabulary complexity

- [ ] [TASK-049] [P2] [US2] Implement LLM-assisted level assessment (file: apps/frontend/src/features/level-detection/services/llmDetector.ts)
  - Function: assessLevelWithLLM(conversationExcerpt: Message[]) â†’ Promise<{level, confidence, strengths, areasToImprove}>
  - Send last 5 messages to AI with assessment prompt
  - Cache result for 5 messages to avoid redundant API calls
  - Parse JSON response from LLM

- [ ] [TASK-050] [P2] [US2] Implement hybrid level detection service (file: apps/frontend/src/features/level-detection/services/levelDetectionService.ts)
  - Combine rule-based (70% weight) + LLM-assisted (30% weight)
  - Function: detectUserLevel(message: string, conversationHistory: Message[]) â†’ CEFRLevel
  - Trigger LLM assessment every 5 messages
  - Update user.currentLevel in IndexedDB
  - Track levelHistory in ProgressMetrics

- [ ] [TASK-051] [P2] [US2] Implement difficulty adaptation logic (file: apps/frontend/src/features/level-detection/services/adaptationService.ts)
  - Function: adaptDifficulty(currentLevel, detectedLevel) â†’ targetLevel
  - If detectedLevel > currentLevel: increase by 0.5 steps (gradual challenge)
  - If detectedLevel < currentLevel: decrease by 1 step (user struggling)
  - Function: getSystemPromptForLevel(targetLevel) â†’ string (prompt for AI)
  - Return tailored system prompts: A1 (simple vocab, short sentences), C1 (idioms, complex structures)

### 3.2 Level Detection - UI Integration

- [ ] [TASK-052] [P2] [US2] Create useLevelDetection hook (file: apps/frontend/src/features/level-detection/hooks/useLevelDetection.ts)
  - Trigger level detection on each user message
  - Update currentLevel in user store
  - Track level changes in levelHistory
  - Debounce updates to avoid excessive re-renders

- [ ] [TASK-053] [P2] [US2] Create LevelBadge component (file: apps/frontend/src/features/level-detection/components/LevelBadge.tsx)
  - Props: level (CEFRLevel), showLabel (boolean)
  - Display CEFR level with color coding: A1 (green), B1 (blue), C1 (purple)
  - Tooltip: explain current level and what it means
  - Animate on level change

- [ ] [TASK-054] [P2] [US2] Integrate LevelBadge in ChatContainer header (file: apps/frontend/src/features/chat/components/ChatContainer.tsx)
  - Show current user level in top-right corner
  - Click to view level explanation tooltip
  - Update in real-time when level changes

- [ ] [TASK-055] [P2] [US2] Update AI streaming to use target level (file: apps/frontend/src/features/chat/hooks/useChat.ts)
  - Get targetLevel from adaptationService before streaming
  - Pass targetLevel to backend API: { messages, targetLevel }
  - Backend includes targetLevel in system prompt

### 3.3 Corrections Feature

- [ ] [TASK-056] [P2] [US2] Define Correction types (file: packages/shared/src/types/correction.ts)
  - Export Correction interface: id, type (grammar|spelling|vocabulary|punctuation|style), original, suggested, explanation, severity (critical|major|minor), position {start, end}
  - Export CorrectionType, CorrectionSeverity enums

- [ ] [TASK-057] [P2] [US2] Implement correction detection service (file: apps/frontend/src/features/corrections/services/correctionService.ts)
  - Function: detectCorrections(userMessage: string, aiResponse: string) â†’ Correction[]
  - Parse AI response for correction hints
  - Alternative: use LLM to analyze user message for errors (POST /api/corrections endpoint)
  - Store corrections in Message.metadata.corrections

- [ ] [TASK-058] [P2] [US2] Create CorrectionHighlight component (file: apps/frontend/src/features/corrections/components/CorrectionHighlight.tsx)
  - Props: text, corrections
  - Render text with colored underlines at correction positions
  - Color coding: critical (red), major (orange), minor (yellow)
  - Click to show CorrectionTooltip

- [ ] [TASK-059] [P2] [US2] Create CorrectionTooltip component (file: apps/frontend/src/features/corrections/components/CorrectionTooltip.tsx)
  - Props: correction (Correction)
  - Display: original, suggested, explanation
  - Show severity badge
  - "Apply suggestion" button (optional feature)

- [ ] [TASK-060] [P2] [US2] Integrate corrections in MessageBubble (file: apps/frontend/src/features/chat/components/MessageBubble.tsx)
  - If message.role = 'user' and corrections exist
  - Wrap content with CorrectionHighlight component
  - Show corrections inline after message is sent (not while typing)

### 3.4 Suggestions Feature

- [ ] [TASK-061] [P2] [US2] Define Suggestion types (file: packages/shared/src/types/suggestion.ts)
  - Export Suggestion interface: id, type (vocabulary|phrase|response|question), text, context, level
  - Export SuggestionType enum

- [ ] [TASK-062] [P2] [US2] Implement suggestion generation service (file: apps/frontend/src/features/suggestions/services/suggestionService.ts)
  - Function: generateSuggestions(conversationHistory: Message[], targetLevel: CEFRLevel) â†’ Suggestion[]
  - Use LLM to suggest: vocabulary to learn, phrases to use, questions to ask
  - Filter suggestions by targetLevel (current or +1 level)
  - Store in Message.metadata.suggestions

- [ ] [TASK-063] [P2] [US2] Create SuggestionChip component (file: apps/frontend/src/features/suggestions/components/SuggestionChip.tsx)
  - Props: suggestion (Suggestion)
  - Render clickable chip with suggestion.text
  - Click to insert suggestion into MessageInput
  - Show tooltip with context explanation

- [ ] [TASK-064] [P2] [US2] Integrate suggestions in ChatContainer (file: apps/frontend/src/features/chat/components/ChatContainer.tsx)
  - Show SuggestionChips above MessageInput (optional, based on user preferences)
  - Generate suggestions after AI response
  - Limit to 3 suggestions at a time

## Phase 4: User Story 3 (P3) - Simple and Engaging Interface (12 tasks)

**Goal**: Polish UI/UX for simplicity, visual appeal, and mobile-first responsiveness.

**Success Criteria**:
- âœ… Users start conversation within 30 seconds without help (SC-005)
- âœ… Interface responsive on 375px-1920px+ (SC-008)
- âœ… Visual design feels simple and attractive

### 4.1 UI Design System

- [ ] [TASK-065] [P3] [US3] Define design tokens (file: apps/frontend/src/index.css)
  - CSS variables: colors (primary, secondary, background, text), spacing scale, typography scale, border radius
  - Configure Tailwind CSS 4 @config directive
  - Implement light and dark themes
  - Ensure WCAG AA contrast ratios: 4.5:1 for text

- [ ] [TASK-066] [P3] [US3] Create reusable Button component (file: apps/frontend/src/shared/components/ui/Button.tsx)
  - Variants: primary, secondary, ghost
  - Sizes: sm, md, lg
  - States: default, hover, active, disabled
  - Touch target: minimum 44x44px (WCAG)
  - Use class-variance-authority for variant management

- [ ] [TASK-067] [P3] [US3] Create reusable Input component (file: apps/frontend/src/shared/components/ui/Input.tsx)
  - Variants: default, error
  - Support textarea with auto-resize
  - Label, placeholder, helper text
  - Error state with validation message

- [ ] [TASK-068] [P3] [US3] Create ErrorBoundary component (file: apps/frontend/src/shared/components/ErrorBoundary.tsx)
  - Catch React errors gracefully
  - Show friendly error message: "Something went wrong. Please refresh the page."
  - Option to reset state or reload app
  - Log errors to console (or error tracking service)

### 4.2 Responsive Design & Mobile-First

- [ ] [TASK-069] [P3] [US3] Implement mobile-first layout (file: apps/frontend/src/features/chat/components/ChatContainer.tsx)
  - Base styles for 375px width (iPhone SE)
  - Breakpoints: sm (640px), md (768px), lg (1024px), xl (1280px)
  - Test on real devices: iPhone SE, iPhone 14, iPad, Desktop
  - Ensure touch targets 44x44px minimum

- [ ] [TASK-070] [P3] [US3] Add theme toggle (light/dark mode) (file: apps/frontend/src/shared/components/ThemeToggle.tsx)
  - Toggle button in ChatContainer header
  - Persist theme preference to localStorage
  - Sync with system preference (prefers-color-scheme)
  - Smooth transition animation

- [ ] [TASK-071] [P3] [US3] Create EmptyState component (file: apps/frontend/src/shared/components/EmptyState.tsx)
  - Props: title, description, icon, action (optional)
  - Use for empty conversation list, no messages
  - Friendly copy: "Start your first conversation!"

- [ ] [TASK-072] [P3] [US3] Add loading states and skeletons (file: apps/frontend/src/shared/components/ui/Skeleton.tsx)
  - Skeleton component for loading messages
  - Shimmer animation
  - Use while fetching data from IndexedDB or API

### 4.3 Animations & Micro-interactions

- [ ] [TASK-073] [P3] [US3] Add message animations (file: apps/frontend/src/features/chat/components/MessageBubble.tsx)
  - Fade-in animation on new message (300ms)
  - Slide-in from bottom (user) or left (AI)
  - 60fps smooth animation (use CSS transforms, not position)

- [ ] [TASK-074] [P3] [US3] Add typing indicator animation (file: apps/frontend/src/features/chat/components/TypingIndicator.tsx)
  - Three animated dots with staggered delay
  - Pulse effect (CSS keyframes)
  - Smooth fade-in/out

- [ ] [TASK-075] [P3] [US3] Add success feedback (file: apps/frontend/src/shared/components/ui/Toast.tsx)
  - Install: npx shadcn@latest add toast
  - Show toast on level up: "Great progress! You're now at B1 level ðŸŽ‰"
  - Show toast on error: "Network error. Please try again."
  - Auto-dismiss after 3 seconds

- [ ] [TASK-076] [P3] [US3] Accessibility improvements (file: apps/frontend/src/App.tsx)
  - Skip to main content link
  - Focus management: auto-focus MessageInput on page load
  - Keyboard shortcuts: Ctrl+N for new conversation, Escape to close modals
  - ARIA live regions for screen reader announcements (new message, typing indicator)

## Phase 5: User Story 4 (P4) - Progress Tracking (11 tasks)

**Goal**: Implement progress dashboard with metrics visualization.

**Success Criteria**:
- âœ… Users can view conversation time, vocabulary count, level progression
- âœ… 60% retention rate (users return within 3 days) (SC-006)

### 5.1 Progress Service Layer

- [ ] [TASK-077] [P4] [US4] Implement progress tracking service (file: apps/frontend/src/features/progress/services/progressService.ts)
  - Function: trackConversationTime(conversationId, durationSeconds) â†’ update totalTime
  - Function: trackVocabulary(words: string[]) â†’ update vocabularyEncountered
  - Function: markVocabularyMastered(word: string) â†’ add to vocabularyMastered
  - Function: trackLevelChange(level: CEFRLevel, confidence: number) â†’ append to levelHistory
  - Update ProgressMetrics in IndexedDB

- [ ] [TASK-078] [P4] [US4] Implement streak calculation (file: apps/frontend/src/features/progress/services/streakService.ts)
  - Function: calculateCurrentStreak(lastActiveDates: Date[]) â†’ number of consecutive days
  - Function: calculateLongestStreak(lastActiveDates: Date[]) â†’ max consecutive days
  - Store lastActive timestamp on each message sent

- [ ] [TASK-079] [P4] [US4] Create useProgress hook (file: apps/frontend/src/features/progress/hooks/useProgress.ts)
  - Load ProgressMetrics from IndexedDB
  - Compute metrics: averageMessagesPerConversation, vocabularyGrowthRate, currentStreak
  - Return reactive state (updates on new message)

### 5.2 Progress UI Components

- [ ] [TASK-080] [P4] [US4] Install chart dependencies (file: apps/frontend/package.json)
  - Install recharts@^2.10.0 or chart.js for data visualization
  - Lightweight alternative: pure CSS charts

- [ ] [TASK-081] [P4] [US4] Create ProgressPanel component (file: apps/frontend/src/features/progress/components/ProgressPanel.tsx)
  - Side panel or modal opened from ChatContainer header button
  - Sections: Current Level, Conversation Stats, Vocabulary Growth, Level History
  - Responsive layout: full-screen on mobile, side panel on desktop

- [ ] [TASK-082] [P4] [US4] Create ProgressMetrics component (file: apps/frontend/src/features/progress/components/ProgressMetrics.tsx)
  - Display cards: Total Conversations, Total Messages, Total Time (hours:minutes)
  - Display: Current Level with LevelBadge
  - Display: Current Streak, Longest Streak
  - Display: Vocabulary Encountered, Vocabulary Mastered

- [ ] [TASK-083] [P4] [US4] Create LevelHistoryChart component (file: apps/frontend/src/features/progress/components/LevelHistoryChart.tsx)
  - Line chart: X-axis (time), Y-axis (CEFR level)
  - Show level progression over time
  - Confidence indicator (opacity or line thickness)
  - Tooltip on hover: date, level, confidence

- [ ] [TASK-084] [P4] [US4] Create VocabularyGrowthChart component (file: apps/frontend/src/features/progress/components/VocabularyGrowthChart.tsx)
  - Bar chart: vocabulary encountered per week
  - Growth rate indicator: words per hour
  - Highlight new vocabulary from last session

### 5.3 Progress Integration

- [ ] [TASK-085] [P4] [US4] Add progress button to ChatContainer header (file: apps/frontend/src/features/chat/components/ChatContainer.tsx)
  - Icon button (chart icon) in header
  - Click to open ProgressPanel
  - Badge: show notification on level up or milestone

- [ ] [TASK-086] [P4] [US4] Track conversation time automatically (file: apps/frontend/src/features/chat/hooks/useChat.ts)
  - Start timer when conversation becomes active
  - Track elapsed time every minute
  - Save to ProgressMetrics on unmount or new message
  - Pause timer when user inactive (5 minutes)

- [ ] [TASK-087] [P4] [US4] Implement milestone notifications (file: apps/frontend/src/features/progress/services/milestoneService.ts)
  - Milestones: First conversation, 10 conversations, 100 messages, Level up, 7-day streak
  - Show toast notification on milestone achieved
  - Store achieved milestones in ProgressMetrics

## Phase 6: Cross-Cutting Concerns & Polish (8 tasks)

**Goal**: Performance optimization, error handling, final testing, deployment preparation.

### 6.1 Performance Optimization

- [ ] [TASK-088] Performance audit with Lighthouse (file: docs/LIGHTHOUSE.md)
  - Run Lighthouse on local build
  - Target: 95+ all categories (Performance, Accessibility, Best Practices, SEO)
  - Core Web Vitals: LCP <2.5s, FID <100ms, CLS <0.1
  - Document results and improvements

- [ ] [TASK-089] Bundle size optimization (file: apps/frontend/vite.config.ts)
  - Analyze bundle with vite-plugin-visualizer
  - Verify total bundle <200KB gzipped (constitution requirement)
  - Remove unused dependencies
  - Tree-shake unnecessary code

### 6.2 Error Handling & Resilience

- [ ] [TASK-090] Implement global error handling (file: apps/frontend/src/App.tsx)
  - Wrap app with ErrorBoundary
  - Catch and log errors to console (or Sentry in production)
  - Show user-friendly error message
  - Provide "Refresh" or "Reset" action

- [ ] [TASK-091] Implement offline support (file: apps/frontend/src/shared/lib/offline/offlineDetector.ts)
  - Detect online/offline status (navigator.onLine)
  - Show banner when offline: "You're offline. Messages will be sent when you reconnect."
  - Queue messages in IndexedDB when offline
  - Retry on reconnection

- [ ] [TASK-092] Add loading states for all async operations (file: apps/frontend/src/features/chat/)
  - Show Skeleton while loading messages from IndexedDB
  - Show TypingIndicator while streaming AI response
  - Show spinner on button actions (send message)

### 6.3 Final Testing & Quality Assurance

- [ ] [TASK-093] E2E test for level adaptation (file: tests/e2e/level-adaptation.spec.ts)
  - Simulate beginner user (simple vocabulary) â†’ verify AI responds simply
  - Simulate advanced user (complex vocabulary) â†’ verify AI responds with complexity
  - Test level up notification
  - Verify CEFR level badge updates

- [ ] [TASK-094] E2E accessibility test suite (file: tests/e2e/accessibility.spec.ts)
  - Run axe-core on all pages
  - Test keyboard navigation end-to-end
  - Test screen reader announcements (manual)
  - Verify touch targets 44x44px
  - Ensure WCAG 2.1 AA compliance

- [ ] [TASK-095] Cross-browser testing (file: docs/TESTING.md)
  - Test on Chrome, Firefox, Safari, Edge (last 2 versions)
  - Test on mobile browsers: iOS Safari, Android Chrome
  - Document browser-specific issues and fixes

### 6.4 Deployment Preparation

- [ ] [TASK-096] Configure production environment variables (file: .env.production)
  - Backend: Production API keys, rate limits, CORS origins
  - Frontend: Production API URL
  - Security: Ensure no secrets in frontend bundle

- [ ] [TASK-097] Write deployment documentation (file: docs/DEPLOYMENT.md)
  - Backend: Deploy Hono to Vercel Edge Functions
  - Frontend: Deploy Vite SPA to Vercel
  - Environment variables setup
  - Monitoring and logging setup (optional: Sentry, LogRocket)

## MVP Scope Definition

**Minimum Viable Product (MVP)** includes:
- âœ… Phase 0: Project Initialization (8 tasks)
- âœ… Phase 1: Foundational Infrastructure (16 tasks)
- âœ… Phase 2: User Story 1 (P1) - Natural AI Conversation (21 tasks)
- âœ… Phase 3: User Story 2 (P2) - Automatic Difficulty Adaptation (18 tasks)

**Total MVP Tasks**: 63 tasks

**Post-MVP Enhancements**:
- Phase 4: User Story 3 (P3) - UI Polish (12 tasks)
- Phase 5: User Story 4 (P4) - Progress Tracking (11 tasks)
- Phase 6: Cross-Cutting Concerns (8 tasks)

**Recommendation**: Focus on MVP (P1 + P2) for initial launch, then iterate with P3 and P4 based on user feedback.

## Task Dependencies

### Critical Path (Must Complete in Order):
1. Phase 0 (TASK-001 to 008) â†’ Phase 1 (Foundation)
2. Phase 1 (TASK-009 to 025) â†’ Phase 2 (Chat Feature)
3. TASK-026 (Backend streaming endpoint) â†’ TASK-029 (Frontend chat service)
4. TASK-033 (ChatContainer) â†’ TASK-034 (MessageList) â†’ TASK-035 (MessageBubble)
5. Phase 2 complete â†’ Phase 3 (Level Detection)

### Parallel Opportunities:
- **Backend and Frontend Foundation** (Phase 1): Can be built by separate developers
  - Backend team: TASK-019 to 025 (AI providers, Hono app)
  - Frontend team: TASK-009 to 018 (IndexedDB, Zustand, TanStack Query)

- **Feature Development** (Phase 2-5): Different features can be developed concurrently
  - Developer A: Chat feature (TASK-026 to 046)
  - Developer B: Level detection (TASK-047 to 055)
  - Developer C: Corrections (TASK-056 to 060)
  - Developer D: Suggestions (TASK-061 to 064)

- **UI Components** (Phase 4): Can be built in parallel with service layers
  - Frontend designer: TASK-065 to 076 (design system, animations)
  - Backend developer: Continue with API enhancements

## Next Steps

1. **Review and Approve Tasks**: Validate task breakdown with stakeholders
2. **Assign Developers**: Distribute tasks based on expertise (frontend, backend, full-stack)
3. **Set Sprint Goals**: Plan 2-week sprints targeting MVP completion
4. **Start with Phase 0**: Initialize monorepo and tooling (1-2 days)
5. **Track Progress**: Update task checkboxes as work completes

**Ready to implement!** Use `/speckit.implement` to execute these tasks in order, or manually assign to team members.

---

**Document Metadata**:
- Total Tasks: 97
- MVP Tasks: 63
- Estimated MVP Duration: 6-8 weeks (2-3 developers)
- Last Updated: 2025-11-15
